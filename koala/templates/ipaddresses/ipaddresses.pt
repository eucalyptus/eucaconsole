<metal:block use-macro="main_template">

<head metal:fill-slot="head_css">
    <link rel="stylesheet" type="text/css" href="${request.static_url('koala:static/css/pages/ipaddresses.css')}" />
</head>

<div metal:fill-slot="main_content">
    <div class="row" id="contentwrap" ng-app="ElasticIPsPage" ng-controller="ElasticIPsCtrl">
        <h3 class="header" id="pagetitle" i18n:translate="">
            IP Addresses
        </h3>
        <!-- Notifications -->
        <metal:block metal:use-macro="layout.global_macros['notifications']"></metal:block>

        <div class="large-2 columns" id="landing-page-filters">
            <div metal:use-macro="layout.global_macros['properties_filter_form']"></div>
        </div>
        <div metal:use-macro="layout.global_macros['landing_page_datagrid']">
            <div metal:fill-slot="new_button">
                <a class="button" data-reveal-id="allocate-ip-modal" i18n:translate="">
                    Allocate IP address
                </a>
            </div>
            <div metal:fill-slot="tile_header">
                <a ng-href="${prefix}/{{ item.public_ip }}">{{ item.public_ip }}</a>
            </div>
            <div metal:fill-slot="tile_content" tal:omit-tag="">
                <div>
                    <span class="label" title="Instance ID" i18n:attributes="title" data-tooltip="">IN</span>
                    <span ng-show="item.instance_id" i18n:translate="">Associated with
                        <b><a ng-href="/instances/{{item.instance_id}}">{{ item.instance_id }}</a></b>
                    </span>
                    <span ng-show="!item.instance_id" i18n:translate="">Not associated with any instances</span>
                </div>
            </div>
            <div metal:fill-slot="tile_dropdown_button" tal:omit-tag="">
                <a class="tiny secondary button dropdown right"><i class="fi-widget"></i></a>
                <ul id="item-dropdown_{{ $index }}" class="f-dropdown">
                    <li ng-show="item.instance_id">
                        <a i18n:translate=""
                           ng-click="revealModal('disassociate', item.public_ip)">Disassociate from instance</a>
                    </li>
                    <li ng-show="!item.instance_id">
                        <a i18n:translate=""
                           ng-click="revealModal('associate', item.public_ip)">Associate with instance</a>
                    </li>
                    <li ng-show="!item.instance_id">
                        <a i18n:translate=""
                           ng-click="revealModal('release', item.public_ip)">Release to cloud</a>
                    </li>
                </ul>
            </div>
            <metal:block metal:fill-slot="tableview_headers">
                <th i18n:translate="">Public IP Address</th>
                <th i18n:translate="">Assigned to Instance</th>
                <th i18n:translate="">Actions</th>
            </metal:block>
            <metal:block metal:fill-slot="tableview_columns">
                <td><a ng-href="${prefix}/{{ item.id || item.public_ip }}">{{ item.public_ip }}</a></td>
                <td><a ng-href="/instances/{{item.instance_id}}">{{ item.instance_id }}</a></td>
                <td>
                    <a class="tiny secondary button dropdown right round"><i class="fi-widget"></i></a>
                    <ul id="item-dropdown_{{ $index }}" class="f-dropdown">
                        <li ng-show="item.instance_id">
                            <a i18n:translate=""
                               ng-click="revealModal('disassociate', item.public_ip)">Disassociate from instance</a>
                        </li>
                        <li ng-show="!item.instance_id">
                            <a i18n:translate=""
                               ng-click="revealModal('associate', item.public_ip)">Associate with instance</a>
                        </li>
                        <li ng-show="!item.instance_id">
                            <a i18n:translate=""
                               ng-click="revealModal('release', item.public_ip)">Release to cloud</a>
                        </li>
                    </ul>
                </td>
            </metal:block>
        </div>
        <!-- Modal dialogs -->
        <div id="allocate-ip-modal" class="reveal-modal small" data-reveal="">
            <h3 i18n:translate="">Allocate IP addresses</h3>
            <p class="lead" i18n:translate="">How may IP addresses would you like to allocate?</p>
            <form action="${request.route_url('ipaddresses')}" method="post" data-abide="abide">
                ${structure:allocate_form['csrf_token']}
                ${panel('form_field', field=allocate_form.ipcount)}
                <input type="hidden" name="display" value="{{ displayType }}" />
                <div class="row">
                    <div class="small-4 columns"></div>
                    <div class="small-8 columns">
                        <button type="submit" class="button radius" i18n:translate="">
                            Allocate addresses from cloud
                        </button>
                    </div>
                </div>
            </form>
            <a class="close-reveal-modal">&#215;</a>
        </div>
        <div id="associate-ip-modal" class="reveal-modal small" data-reveal="">
            <h3 i18n:translate="">Associate IP Address</h3>
            <p i18n:translate="">Associate <b>{{ publicIP }}</b> with an instance</p>
            <form action="${request.route_url('ipaddresses_associate')}" method="post" data-abide="abide">
                ${structure:associate_form['csrf_token']}
                <input type="hidden" name="display" value="{{ displayType }}" />
                <input type="hidden" name="public_ip" value="{{ publicIP }}" />
                ${panel('form_field', field=associate_form.instance_id)}
                <div class="row">
                    <div class="small-4 columns">&nbsp;</div>
                    <div class="small-8 columns field inline">
                        <input type="submit" class="button" value="Associate with Instance" i18n:attributes="value" />
                    </div>
                </div>
            </form>
            <a class="close-reveal-modal">&#215;</a>
        </div>
        <div id="disassociate-ip-modal" class="reveal-modal small" data-reveal="">
            <h3 i18n:translate="">Disassociate IP Address</h3>
            <p i18n:translate="">If you disassociate an IP address from an instance,
                you will no longer be able to connect to that instance using that IP address.</p>
            <p i18n:translate="">Are you sure you want to disassociate <b>{{ publicIP }}</b>
                from the instance?</p>
            <form action="${request.route_url('ipaddresses_disassociate')}" method="post">
                ${structure:disassociate_form['csrf_token']}
                <input type="hidden" name="display" value="{{ displayType }}" />
                <input type="hidden" name="public_ip" value="{{ publicIP }}" />
                <input type="submit" class="button" value="Yes, disassociate" />
            </form>
            <a class="close-reveal-modal">&#215;</a>
        </div>
        <div id="release-ip-modal" class="reveal-modal small" data-reveal="">
            <h3 i18n:translate="">Release IP Address to Cloud</h3>
            <p i18n:translate="">If you release an IP address to the cloud, you can no longer associate
                that IP address with any of your instances.
                If the IP address is currently associated with an instance when you release it to the cloud,
                the instance will get a new IP address as long as you did not
                specify private addressing when you launched the instance.</p>
            <p i18n:translate="">Are you sure you want to release {{ publicIP }} to the cloud?</p>
            <form action="${request.route_url('ipaddresses_release')}" method="post">
                ${structure:release_form['csrf_token']}
                <input type="hidden" name="display" value="{{ displayType }}" />
                <input type="hidden" name="public_ip" value="{{ publicIP }}" />
                <input type="submit" class="button" value="Yes, release" />
            </form>
            <a class="close-reveal-modal">&#215;</a>
        </div>
    </div>
</div>

<div metal:fill-slot="tail_js">
    <script src="${request.static_url('koala:static/js/thirdparty/utils/purl.js')}"></script>
    <script src="${request.static_url('koala:static/js/pages/landingpage.js')}"></script>
    <script src="${request.static_url('koala:static/js/pages/ipaddresses.js')}"></script>
</div>

</metal:block>

