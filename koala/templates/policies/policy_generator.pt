<table id="policy-generator" class="table actions-wrapper">
    <thead>
        <tr>
            <th class="allow" i18n:translate="">Allow</th>
            <th class="deny" i18n:translate="">Deny</th>
            <th class="actions">&nbsp;</th>
            <th class="advanced">&nbsp;</th>
        </tr>
    </thead>
    <tbody>
        <metal:block tal:repeat="actions_ns policy_actions">
            <tr class="namespace ${namespace}" tal:define="namespace actions_ns.name">
                <td class="allow">
                    <a ng-click="selectAll($event)">
                        <i class="fi-check tick" data-namespace="${namespace}" data-effect="Allow"
                           data-action="${namespace}:*" data-resource="*"></i>
                    </a>
                </td>
                <td class="deny">
                    <a ng-click="selectAll($event)">
                        <i class="fi-x tick" data-namespace="${namespace}" data-effect="Deny"
                           data-action="${namespace}:*" data-resource="*"></i>
                    </a>
                </td>
                <td class="actions-namespace">
                    <div class="expando" ng-init="${namespace}Expanded = false" ng-cloak="">
                        <strong class="title" >
                            <a ng-click="${namespace}Expanded = !${namespace}Expanded">
                                <i class="fi-plus" ng-show="!${namespace}Expanded"></i>
                                <i class="fi-minus" ng-show="${namespace}Expanded"></i>
                                &nbsp;<span i18n:translate="">${actions_ns.label}</span>
                            </a>
                        </strong>
                    </div>
                </td>
                <td>&nbsp;</td>
            </tr>
            <tr class="action ${namespace} ${action}" tal:define="namespace actions_ns.name" ng-init="${action}Resources = []"
                tal:repeat="action actions_ns.actions" ng-show="${namespace}Expanded">
                <div tal:define="namespace_condition namespace not in ['elasticloadbalancing', 'autoscaling']">
                    <td class="allow">
                        <a ng-click="selectAction($event)">
                            <i class="fi-check tick" data-namespace="${namespace}" data-effect="Allow"
                               data-action="${namespace}:${action}" data-resource="*"></i>
                        </a>
                    </td>
                    <td class="deny">
                        <a ng-click="selectAction($event)">
                            <i class="fi-x tick" data-namespace="${namespace}" data-effect="Deny"
                               data-action="${namespace}:${action}" data-resource="*"></i>
                        </a>
                    </td>
                    <td>
                        <span class="action-name">${action}</span>
                        <div class="advanced hide">
                            <div class="resource-wrapper" tal:condition="namespace_condition">
                                <div>&nbsp;</div>
                                <h6 i18n:translate="">Resources</h6>
                                <div tal:condition="layout.cloud_type == 'euca'"
                                     tal:define="instance_condition 'Instance' in action
                                                     or 'AttachVolume' in action or 'DetachVolume' in action
                                                     or 'Console' in action;
                                                 image_condition 'Image' in action;
                                                 volume_condition 'Volume' in action;
                                                 snapshot_condition 'Snapshot' in action;
                                                 securitygroup_condition 'SecurityGroup' in action;
                                                 keypair_condition 'KeyPair' in action;
                                                 ipaddress_condition 'Address' in action;">
                                    <div class="added-resources">
                                        <span class="label radius secondary resentry" ng-cloak=""
                                              ng-repeat="resource in ${action}Resources track by $index">
                                            {{ resource }}
                                            <a class="remove" ng-click="removeResource('${action}', $index, $event)"
                                               title="Remove resource"><i class="fi-x"></i></a>
                                        </span>
                                    </div>
                                    <div tal:condition="namespace != 'ec2'" tal:omit-tag="">
                                        <label i18n:translate="" ng-show="${action}Resources.length === 0">
                                            Set a specific resource (ARN):
                                        </label>
                                        <label i18n:translate="" ng-show="${action}Resources.length > 0">
                                            Set another resource (ARN):
                                        </label>
                                        <input type="text" placeholder="All resources" i18n:attributes="placeholder"
                                               class="resource arn" value="arn:aws:${namespace}:::" />
                                    </div>
                                    <div tal:condition="namespace == 'ec2'" tal:omit-tag="">
                                        <select class="resource-type">
                                            <option value="instance" tal:condition="instance_condition">
                                                Instance
                                            </option>
                                            <option value="vm_type" tal:condition="instance_condition">
                                                VM Type
                                            </option>
                                            <option value="image" tal:condition="image_condition">
                                                Image
                                            </option>
                                            <option value="security_group" tal:condition="securitygroup_condition">
                                                Security group
                                            </option>
                                            <option value="ip_address" tal:condition="ipaddress_condition">
                                                IP Address or range
                                            </option>
                                            <option value="availability_zone">
                                                Availability zone
                                            </option>
                                            <option value="key_pair" tal:condition="keypair_condition">
                                                Key pair
                                            </option>
                                            <option value="volume" tal:condition="volume_condition">
                                                Volume
                                            </option>
                                            <option value="snapshot" tal:condition="snapshot_condition">
                                                Snapshot
                                            </option>
                                        </select>
                                        <strong class="equal">=</strong>
                                        <input type="text" class="resource ip_address" tal:condition="ipaddress_condition" />
                                        <select class="resource instance chosen" tal:condition="instance_condition">
                                            <option tal:repeat="choice instance_choices" value="${choice[0]}">${choice[1]}</option>
                                        </select>
                                        <select class="resource vm_type chosen" tal:condition="instance_condition">
                                            <option tal:repeat="choice vm_type_choices" value="${choice[0]}">${choice[1]}</option>
                                        </select>
                                        <select class="resource image chosen" tal:condition="image_condition">
                                            <option tal:repeat="choice image_choices" value="${choice[0]}">${choice[1]}</option>
                                        </select>
                                        <select class="resource security_group chosen" tal:condition="securitygroup_condition">
                                            <option tal:repeat="choice security_group_choices" value="${choice[0]}">${choice[1]}</option>
                                        </select>
                                        <select class="resource availability_zone chosen">
                                            <option tal:repeat="choice availability_zone_choices" value="${choice[0]}">${choice[1]}</option>
                                        </select>
                                        <select class="resource key_pair chosen" tal:condition="keypair_condition">
                                            <option tal:repeat="choice key_pair_choices" value="${choice[0]}">${choice[1]}</option>
                                        </select>
                                        <select class="resource volume chosen" tal:condition="volume_condition">
                                            <option tal:repeat="choice volume_choices" value="${choice[0]}">${choice[1]}</option>
                                        </select>
                                        <select class="resource snapshot chosen" tal:condition="snapshot_condition">
                                            <option tal:repeat="choice snapshot_choices" value="${choice[0]}">${choice[1]}</option>
                                        </select>
                                    </div>
                                </div>
                                <a class="button tiny round" i18n:translate=""
                                   ng-click="addResource('${action}', $event)">
                                    Set Resource
                                </a>
                                <div>&nbsp;</div>
                            </div><!--! /end resource-wrapper -->
                            <div class="conditions-wrapper">
                                <h6 i18n:translate="">Conditions</h6>
                                <div ng-show="${action}ConditionsExpanded" class="conditions">
                                    TBD
                                </div>
                            </div>
                        </div>
                    </td>
                    <td>
                        <a class="button tiny round" ng-click="toggleAdvanced($event)">Advanced</a>
                    </td>
                </div>
            </tr>
        </metal:block>
    </tbody>
</table>

